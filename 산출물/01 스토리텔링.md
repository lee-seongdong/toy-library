# 1. 비즈니스 이해
Q. 시스템이 사용되는 상황
- 공공 도서관

Q. 규모 (회원 수, 도서 수)
- 회원 300명, 도서 1만권

Q. 주요 사용자
- 도서 대출 회원

Q. 해결해야하는 가장 중요한 문제
- 대출과 반납 프로세스

# 2. 액터와 워크오브젝트 식별
Q. 시스템 사용자는?
- 도서 대출 회원
- 도서 관리자

Q. 외부 시스템은?
- 외부 도서 정보 시스템
- 알림 시스템(toy 에서는 redis로 구현)

Q. 시스템에서 다루는 핵심 대상
- 도서
- 회원
- 대출 기록
- 예약
- 연체
- 리뷰

# 3. 스토리 식별
1. 도서 대출 프로세스
```
1. 일반 회원이 도서를 검색
2. 대출 가능한지 확인
    (대출 가능) -> 자동 승인
    (대출 불가능) -> 예약 혹은 취소
```

2. 도서 예약 프로세스
```
1. 일반 회원이 도서 예약 신청
2. 대기 순서에 등록
3. 본인 순서가 왔을 때 알림 발송
4. 본인 순서가 오고 3일간
    (대출함) -> 정상 도서 대출
    (대출 하지 않음) -> 자동으로 대출 취소 -> 알림 발송
```

3. 반납 프로세스
```
1. 일반 회원이 도서 반납 신청
2. 반납된 도서를 관리자가 확인
    (정상) -> 반납 완료 처리
    (연체됨) -> 연체료 납부 알림 발송
    (파손됨) -> 도서비 납부 알림 발송
```

# 4. 비즈니스 규칙 식별
1. 대출 규칙
    1. 대출 가능 권수는 1인당 최대 5권
    2. 기본 대출 기간은 7일. 연장은 2회, 3일씩 가능
    3. 2회 이상 연체중인 회원은 대출 불가능
    4. 연체료 납부 여부는 상관없음
2. 예약 규칙
    1. 도서 1권당 최대 5명까지 예약
    2. 회원 1명이 동시에 3권까지 예약 가능
    3. 본인 순서가 왔을때 3일간 대출 우선권, 이후에는 자동 취소
3. 반납 규칙
    1. 연체료는 하루당 100원
    2. 최대 연체료는 도서 가격만큼
    3. 연체 2회부터 대출 불가능. 연체료 납부 시 다시 대출 가능함
    4. 연체 횟수는 연체 시점부터 바로 적용
    5. 파손된 도서비는 도서 입고 날짜에 따라 다름
        - 0~7일: 정가의 80%
        - 7~14일: 정가의 70%
        - 이후: 정가의 60%
4. 회원 상태 전환 규칙
    1. 활성 -> (연체 2회) -> 정지
    2. 정지 -> (연체된 도서 반납 및 연체료 납부) -> 활성
    3. 활성/정지 -> (탈퇴) -> 탈퇴

5. 대여 상태 전환 규칙
    1. 대여 가능 -> 대여 중
    2. 대여중 -> 정리중
    3. 대여중 -> 연체됨 -> 정리중
    4. 정리중 -> 대여 가능
    5. 정리중 -> 대여 대기
    6. 정리중 -> 파손됨


# 5. 스토리 그룹핑 (워크오브젝트 중심)
```
[대출 스토리]
- 회원이 도서 대출 신청
- 시스템이 대출 가능 여부 확인
- 시스템이 대출 자동 승인
- 회원이 대출 연장
- 회원이 대출 내역 조회

[예약 스토리]
- 회원이 대출 불가능한 도서 예약신청
- 시스템이 예약 대기열에 등록
- 시스템이 예약 순서가 된 회원에게 알림 발송
- 회원이 예약을 취소
- 시스템이 예약 순서가 된 후 3일 경과된 예약을 자동 취소

[반납 스토리]
- 회원이 도서 반납 신청
- 관리자가 반납된 도서 확인 및 등록
- 시스템이 반납 처리
- 시스템이 연체 여부 확인
- 시스템이 파손 여부 확인
```

# 6. 우선순위 설정
```
[phase 1]
- 회원 도메인
- 도서 도메인
- 대출 도메인
- 반납 도메인
- 연체 도메인

[phase 2]
- 예약 도메인
- 알림 도메인

[phase 3]
- 리뷰 도메인

```