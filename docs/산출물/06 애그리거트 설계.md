# 1. ì• ê·¸ë¦¬ê±°íŠ¸ í›„ë³´ ì‹ë³„
- ëŒ€ì—¬ ì»¨í…ìŠ¤íŠ¸
    - Loan ì• ê·¸ë¦¬ê±°íŠ¸ (ëŒ€ì—¬ + ì—°ì¥)
    - Reservation ì• ê·¸ë¦¬ê±°íŠ¸ (ì˜ˆì•½)
- ì¹´íƒˆë¡œê·¸ ì»¨í…ìŠ¤íŠ¸
    - Book ì• ê·¸ë¦¬ê±°íŠ¸ (ë„ì„œ ì •ë³´)
    - Review ì• ê·¸ë¦¬ê±°íŠ¸ (ë¦¬ë·°)
- íšŒì› ì»¨í…ìŠ¤íŠ¸
    - Member ì• ê·¸ë¦¬ê±°íŠ¸ (íšŒì› ì •ë³´)
- ì•Œë¦¼ ì»¨í…ìŠ¤íŠ¸
    - Notification ì• ê·¸ë¦¬ê±°íŠ¸ (ì•Œë¦¼)
- ì¸ì¦ ì»¨í…ìŠ¤íŠ¸
    - User ì• ê·¸ë¦¬ê±°íŠ¸ (ì‚¬ìš©ì ì¸ì¦)


# 2. ì• ê·¸ë¦¬ê±°íŠ¸ ì„¤ê³„
## 2.1. Loan ì• ê·¸ë¦¬ê±°íŠ¸
1. LoanStatus (VO)
```java
enum LoanStatus {
    AVAILABLE,      // ëŒ€ì—¬ ê°€ëŠ¥ (ì´ˆê¸° ìƒíƒœ - ë„ì„œ ê´€ì )
    ON_LOAN,        // ëŒ€ì—¬ ì¤‘ 
    PROCESSING,     // ì •ë¦¬ì¤‘ (ë°˜ë‚©ë˜ì–´ ê´€ë¦¬ìê°€ ì •ë¦¬ì¤‘)
    LOAN_WAITING,   // ëŒ€ì—¬ ëŒ€ê¸° (ì˜ˆì•½ ìˆœì„œê°€ ì™€ì„œ 3ì¼ê°„ ìš°ì„ ê¶Œ)
    OVERDUE,        // ì—°ì²´ë¨
    DAMAGED         // íŒŒì†ë¨
}
```

2. LoanPeriod (VO)
```java
class LoanPeriod {
    private final LocalDate startDate;
    private final LocalDate dueDate;
    
    public static LoanPeriod standardPeriod() {
        LocalDate now = LocalDate.now();
        return new LoanPeriod(now, now.plusDays(7));
    }
    
    public LoanPeriod extend(int days) {
        return new LoanPeriod(startDate, dueDate.plusDays(days));
    }
    
    public boolean isOverdue() {
        return LocalDate.now().isAfter(dueDate);
    }
    
    public int getOverdueDays() {
        if (!isOverdue()) return 0;
        return (int) ChronoUnit.DAYS.between(dueDate, LocalDate.now());
    }
    
    // ì—°ì¥ ì´ë ¥ ê´€ë¦¬ë¥¼ ìœ„í•œ ë©”ì„œë“œ âœ¨
    public LocalDate getDueDate() {
        return dueDate;
    }
}
```

3. LoanExtension (VO)
```java
class LoanExtension {
    private ExtensionId id;
    private String reason;
    private LocalDateTime requestedAt;   // ì—°ì¥ ìš”ì²­ì¼ âœ¨ ì¶”ê°€
    private LocalDate newDueDate;       // ì—°ì¥ í›„ ë°˜ë‚©ì˜ˆì •ì¼ âœ¨ ì¶”ê°€
    private int extendedDays;           // ì—°ì¥ ì¼ìˆ˜ (ê¸°ë³¸ 3ì¼)
    
    // íŒ¨í‚¤ì§€ í”„ë¼ì´ë¹— ìƒì„±ì
    LoanExtension(String reason, LocalDate currentDueDate) {
        this.id = ExtensionId.generate();
        this.reason = reason;
        this.requestedAt = LocalDateTime.now();
        this.extendedDays = 3;  // ê¸°ë³¸ 3ì¼
        this.newDueDate = currentDueDate.plusDays(extendedDays);
    }
}
```

4. Loan (Entity)
```java
class Loan {
    // ì‹ë³„ì
    private LoanId id;
    
    // ì™¸ë¶€ ì• ê·¸ë¦¬ê±°íŠ¸ ì°¸ì¡° (IDë§Œ)
    private MemberId memberId;
    private ISBN bookIsbn;
    
    // ê°’ ê°ì²´ë“¤
    private LoanPeriod period;
    private LoanStatus status;
    
    // ë‚ ì§œ ì •ë³´
    private LocalDateTime borrowedAt;
    private LocalDateTime returnedAt;
    
    // ë‚´ë¶€ ì—”í‹°í‹°
    private List<LoanExtension> extensions;
    
    // ê¸°ë³¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œë“¤
    public void borrow() { ... }
    public void returnBook() { ... }
    public void extend(String reason) { ... }
    public boolean isOverdue() { ... }
    public Money calculatePenalty(Money bookPrice) { ... }
    
    // ìƒíƒœ ì „í™˜ ë©”ì„œë“œë“¤
    public void completeReturn() { ... }
    public void assignToReservation() { ... }
    public void markAsDamaged() { ... }
    public void markAsOverdue() { ... }


    // ìƒíƒœ ì „í™˜ ë©”ì„œë“œë“¤
    public void borrow() {
        // AVAILABLE â†’ ON_LOAN
        if (this.status != LoanStatus.AVAILABLE) {
            throw new IllegalStateException("Book is not available for loan");
        }
        this.status = LoanStatus.ON_LOAN;
        // ... ê¸°íƒ€ ë¡œì§
    }
    
    public void returnBook() {
        // ON_LOAN â†’ PROCESSING ë˜ëŠ” OVERDUE â†’ PROCESSING
        if (this.status != LoanStatus.ON_LOAN && this.status != LoanStatus.OVERDUE) {
            throw new IllegalStateException("Cannot return book in current status");
        }
        this.status = LoanStatus.PROCESSING;
        this.returnedAt = LocalDateTime.now();
    }
    
    public void completeReturn() {
        // PROCESSING â†’ AVAILABLE (ê´€ë¦¬ì í™•ì¸ í›„)
        if (this.status != LoanStatus.PROCESSING) {
            throw new IllegalStateException("Book is not in processing status");
        }
        this.status = LoanStatus.AVAILABLE;
    }
    
    public void assignToReservation() {
        // PROCESSING â†’ LOAN_WAITING (ì˜ˆì•½ìê°€ ìˆëŠ” ê²½ìš°)
        if (this.status != LoanStatus.PROCESSING) {
            throw new IllegalStateException("Book is not in processing status");
        }
        this.status = LoanStatus.LOAN_WAITING;
    }
    
    public void markAsDamaged() {
        // PROCESSING â†’ DAMAGED (íŒŒì† í™•ì¸ ì‹œ)
        if (this.status != LoanStatus.PROCESSING) {
            throw new IllegalStateException("Book is not in processing status");
        }
        this.status = LoanStatus.DAMAGED;
    }
    
    public void markAsOverdue() {
        // ON_LOAN â†’ OVERDUE (ì‹œê°„ ê²½ê³¼, ì‹œìŠ¤í…œ ìë™)
        if (this.status != LoanStatus.ON_LOAN) {
            throw new IllegalStateException("Only active loans can become overdue");
        }
        this.status = LoanStatus.OVERDUE;
    }


    public void extend(String reason) {
        if (this.status != LoanStatus.ACTIVE) {
            throw new IllegalStateException("Cannot extend non-active loan");
        }
        
        if (this.extensions.size() >= 2) {
            throw new MaxExtensionExceededException("Maximum 2 extensions allowed");
        }
        
        if (this.isOverdue()) {
            throw new CannotExtendOverdueLoanException("Cannot extend overdue loan");
        }
        
        // ì—°ì¥ ì´ë ¥ ì¶”ê°€
        LoanExtension extension = new LoanExtension(reason, this.period.getDueDate());
        this.extensions.add(extension);
        
        // ëŒ€ì—¬ ê¸°ê°„ ì—°ì¥
        this.period = this.period.extend(3);
        
        // ë„ë©”ì¸ ì´ë²¤íŠ¸ ë°œí–‰
        DomainEvents.raise(new LoanExtended(this.id, reason, extension.getNewDueDate()));
    }

    public Money calculatePenalty(Money bookPrice) {
        if (!isOverdue()) {
            return Money.ZERO;
        }
        
        int overdueDays = this.period.getOverdueDays();
        Money dailyPenalty = Money.of(100); // í•˜ë£¨ë‹¹ 100ì›
        Money totalPenalty = dailyPenalty.multiply(overdueDays);
        
        // ìµœëŒ€ ì—°ì²´ë£ŒëŠ” ë„ì„œ ê°€ê²©ê¹Œì§€
        return totalPenalty.min(bookPrice);
    }    
}
```


## 2.2. Reservation ì• ê·¸ë¦¬ê±°íŠ¸
- ë£¨íŠ¸: Reservation
- ê°’ ê°ì²´: ReservationId, ReservationStatus, ReservationOrder
- ì™¸ë¶€ ì°¸ì¡°: MemberId, ISBN (ID ì°¸ì¡°)
- ì£¼ìš” ë©”ì„œë“œ: reserve(), cancel(), assignPriority()


## 2.3. Member ì• ê·¸ë¦¬ê±°íŠ¸  
- ë£¨íŠ¸: Member
- ê°’ ê°ì²´: MemberId, MemberName, Contact, MemberStatus
- ì£¼ìš” ë©”ì„œë“œ: register(), suspend(), activate()


## 2.4. Book ì• ê·¸ë¦¬ê±°íŠ¸
- ë£¨íŠ¸: Book  
- ê°’ ê°ì²´: ISBN, BookTitle, Author, Price, BookStatus
- ì£¼ìš” ë©”ì„œë“œ: register(), update(), markDamaged()

# 3. íŒ¨í‚¤ì§€ êµ¬ì¡°
```
src/main/java/com/library/
â”œâ”€â”€ shared/                    # ê³µí†µ ìš”ì†Œ
â”‚   â”œâ”€â”€ domain/               # ê³µí†µ ë„ë©”ì¸
â”‚   â”‚   â”œâ”€â”€ vo/              # ê³µí†µ ê°’ ê°ì²´
â”‚   â”‚   â”‚   â”œâ”€â”€ ISBN.java
â”‚   â”‚   â”‚   â”œâ”€â”€ MemberId.java
â”‚   â”‚   â”‚   â”œâ”€â”€ Money.java
â”‚   â”‚   â”‚   â””â”€â”€ Email.java
â”‚   â”‚   â”œâ”€â”€ event/           # ê³µí†µ ë„ë©”ì¸ ì´ë²¤íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ DomainEvent.java
â”‚   â”‚   â””â”€â”€ exception/       # ê³µí†µ ë„ë©”ì¸ ì˜ˆì™¸
â”‚   â”‚       â””â”€â”€ DomainException.java
â”‚   â”œâ”€â”€ application/         # ê³µí†µ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”‚   â”œâ”€â”€ config/         # ì„¤ì •
â”‚   â”‚   â”‚   â”œâ”€â”€ JpaConfig.java
â”‚   â”‚   â”‚   â””â”€â”€ EventConfig.java
â”‚   â”‚   â””â”€â”€ event/          # ì´ë²¤íŠ¸ ì²˜ë¦¬
â”‚   â”‚       â””â”€â”€ EventPublisher.java
â”‚   â””â”€â”€ infrastructure/      # ê³µí†µ ì¸í”„ë¼
â”‚       â”œâ”€â”€ web/            # ì›¹ ê³µí†µ
â”‚       â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚       â”‚   â”œâ”€â”€ ApiResponse.java
â”‚       â”‚   â””â”€â”€ resolver/   # ArgumentResolver
â”‚       â”œâ”€â”€ persistence/    # ì˜ì†ì„± ê³µí†µ
â”‚       â”‚   â””â”€â”€ BaseEntity.java
â”‚       â””â”€â”€ security/       # ë³´ì•ˆ ê³µí†µ
â”‚           â””â”€â”€ SecurityConfig.java
â”‚
â”œâ”€â”€ loan/                     # ëŒ€ì—¬ ì»¨í…ìŠ¤íŠ¸ ğŸ¯
â”‚   â”œâ”€â”€ domain/              # ë„ë©”ì¸ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ model/          # ë„ë©”ì¸ ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Loan.java           # ì• ê·¸ë¦¬ê±°íŠ¸ ë£¨íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanExtension.java  # ì—”í‹°í‹°
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanId.java         # ì‹ë³„ì
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanStatus.java     # ì—´ê±°í˜•
â”‚   â”‚   â”‚   â””â”€â”€ LoanPeriod.java     # ê°’ ê°ì²´
â”‚   â”‚   â”œâ”€â”€ service/        # ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ LoanDomainService.java
â”‚   â”‚   â”œâ”€â”€ repository/     # ë¦¬í¬ì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ LoanRepository.java
â”‚   â”‚   â”œâ”€â”€ event/          # ë„ë©”ì¸ ì´ë²¤íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ BookBorrowed.java
â”‚   â”‚   â”‚   â””â”€â”€ BookReturned.java
â”‚   â”‚   â””â”€â”€ exception/      # ë„ë©”ì¸ ì˜ˆì™¸
â”‚   â”‚       â”œâ”€â”€ MaxExtensionExceededException.java
â”‚   â”‚       â””â”€â”€ CannotExtendOverdueLoanException.java
â”‚   â”œâ”€â”€ application/         # ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ service/        # ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
â”‚   â”‚   â”‚   â””â”€â”€ LoanApplicationService.java
â”‚   â”‚   â”œâ”€â”€ dto/            # DTO
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanRequest.java
â”‚   â”‚   â”‚   â””â”€â”€ LoanResponse.java
â”‚   â”‚   â””â”€â”€ handler/        # ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
â”‚   â”‚       â””â”€â”€ LoanEventHandler.java
â”‚   â”œâ”€â”€ infrastructure/      # ì¸í”„ë¼ ê³„ì¸µ
â”‚   â”‚   â”œâ”€â”€ persistence/    # ì˜ì†ì„±
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanJpaRepository.java
â”‚   â”‚   â”‚   â”œâ”€â”€ LoanRepositoryImpl.java
â”‚   â”‚   â”‚   â””â”€â”€ entity/
â”‚   â”‚   â”‚       â””â”€â”€ LoanJpaEntity.java
â”‚   â”‚   â””â”€â”€ client/         # ì™¸ë¶€ ì‹œìŠ¤í…œ í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚       â””â”€â”€ MemberClient.java
â”‚   â””â”€â”€ presentation/        # í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ
â”‚       â””â”€â”€ controller/
â”‚           â””â”€â”€ LoanController.java
â”‚
â”œâ”€â”€ member/                   # íšŒì› ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ presentation/
â”‚
â”œâ”€â”€ catalog/                  # ì¹´íƒˆë¡œê·¸ ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ presentation/
â”‚
â”œâ”€â”€ notification/             # ì•Œë¦¼ ì»¨í…ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ presentation/
â”‚
â””â”€â”€ auth/                     # ì¸ì¦ ì»¨í…ìŠ¤íŠ¸
    â”œâ”€â”€ domain/
    â”œâ”€â”€ application/
    â”œâ”€â”€ infrastructure/
    â””â”€â”€ presentation/
```
