# 컨텍스트 관계 패턴
두 컨텍스트간의 의존성, 우선순위 등에 의해 맺어진 관계를 특징에 따라 분류된 패턴

## 1. 분류
### 1.1. 동등한 관계
- **Partnership**: 상호 협력 관계. 두 컨텍스트가 대등하게 이벤트와 API를 주고받음
    ```
    ┌─────────────┐ ←──Partnership──→ ┌─────────────┐
    │ 대출 컨텍스트 │                   │ 회원 컨텍스트 │
    │             │   양방향 협력       │             │
    └─────────────┘                   └─────────────┘
    ```
- **Shared Kernel**: 작은 공통 모델 공유. 두 컨텍스트가 일부 도메인 모델을 공동 소유 (공유 도메인, 공유 라이브러리)
    ```
    ┌─────────────┐                   ┌─────────────┐
    │ 대출 컨텍스트 │                   │ 회원 컨텍스트 │
    └──────┬──────┘                   └──────┬──────┘
           │                                 │
           └──────────┬──────────────────────┘
                      ↓
              ┌──────────────┐
              │ Shared Kernel│
              │ (공통 모델)   │
              │  Member ID   │
              └──────────────┘
    ```

### 1.2. 상하 관계
- **Customer-Supplier**: 공급자가 우선권을 가지는 관계. API 호출이나 이벤트 구독으로 통합. (인터페이스는 공급자가 결정하고, 모델은 변환하여 사용가능)
```
┌─────────────┐                   ┌─────────────┐
│ 대출 컨텍스트 │ ───Customer────→  │카탈로그 컨텍스트│
│  (고객)      │                   │  (공급자)    │
└─────────────┘ ←──Supplier────   └─────────────┘
```

- **Conformist**: 하위가 상위 모델에 완전히 순응. API 호출이나 이벤트 구독으로 통합. (인터페이스는 상위 컨텍스트가 결정하고, 모델은 변환하지 않고 그대로 사용)
```
┌─────────────┐                   ┌─────────────┐
│ 통계 컨텍스트 │ ──Conformist───→  │ 대출 컨텍스트 │
│  (순응자)    │   따라감           │  (상위)      │
└─────────────┘ ←───────────────  └─────────────┘
```

### 1.3. 격리 관계
- **Anti-Corruption Layer**: 외부 시스템으로부터 내부 모델 보호. Adapter로 변환 계층 구축
```
┌─────────────┐      ACL      ┌─────────────┐
│신규 대출 시스템│ ←─────────→  │레거시 시스템 │
│             │   Adapter     │ (외부)      │
└─────────────┘   변환 계층    └─────────────┘
```
- **Open Host Service**: 표준 서비스를 다수에게 제공. 공개 API 제공 (1:N 관계)
```
                 ┌─────────────┐
             ┌──→│ 대출 컨텍스트 │
             │   └─────────────┘
┌────────────┴─┐
│카탈로그 컨텍스트│ ─→ 통계 컨텍스트
│(Open Host)   │
└────────────┬─┘
             │   ┌─────────────┐
             └──→│ 추천 컨텍스트 │
                 └─────────────┘
        공개 API (1:N)
```


### 1.4. 독립 관계
- **Separate Ways**: 통합하지 않고 완전히 독립적으로 개발. 컨텍스트 간 연결 없음
```
┌───────────────┐              ┌───────────────┐
│ 도서관 컨텍스트 │              │카페테리아 컨텍스트│
│               │  (연결 없음)  │               │
└───────────────┘              └───────────────┘
```

### 1.5. 보조 패턴
- **Published Language**: 표준 데이터 형식 정의. Open Host Service와 함께 사용 (JSON Schema 등)
- **Big Ball of Mud**: 레거시 시스템 (안티패턴 인식). ACL로 격리하여 대응


## 2. 패턴 결정 과정
```
컨텍스트 A와 B를 통합해야 하는가?
    │
    ├─ NO → Separate Ways
    │
    └─ YES → 레거시/외부인가?
           │
           ├─ YES → Anti-Corruption Layer
           │
           └─ NO → 우리 권한으로 변경 가능한가?
                  │
                  ├─ NO → Conformist
                  │
                  └─ YES → 대등한 관계인가?
                         │
                         ├─ YES → 공통 모델 필요?
                         │        │
                         │        ├─ YES → Shared Kernel
                         │        └─ NO → Partnership
                         │
                         └─ NO → 다수 클라이언트?
                                │
                                ├─ YES → Open Host Service
                                └─ NO → Customer-Supplier
```

## 3. 산출물
### 3.1. 컨텍스트 맵
컨텍스트 관계를 시각화한 다이어그램
```
┌─────────┐                    ┌─────────┐
│  회원    │←────Partnership───→│  대출   │
│         │                    │ (핵심)  │
└────┬────┘                    └────┬────┘
     │                              │
     │ Shared Kernel                │ Customer
     │ (member ID,                  │ -Supplier
     │  book ID)                    ↓
     │                         ┌─────────┐
     │                         │카탈로그  │
     │                         │[공개API]│
     └─────────────────────────┴────┬────┘
                                    │
                    ┌───────────────┼───────────┐
                    ↓               ↓           ↓
                 [통계]           [추천]      [알림]
              (Conformist)    (Conformist) (Customer)
```